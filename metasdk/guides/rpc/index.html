

<!DOCTYPE html>
<html lang="ru" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.111.3">
    <meta name="description" content="">


    <title>Meta Services :: META | Devision Developers</title>
    <link rel="shortcut icon" href="https://rwstatic.ru/h/meta/favicon.ico" type="image/x-icon" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800&amp;subset=cyrillic-ext" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue_grey-pink.min.css" />

      <link href="https://developers.devision.io/metasdk/css/hybrid.css" rel="stylesheet">
    <link href="https://developers.devision.io/metasdk/css/horsey.css" rel="stylesheet">
    <link href="https://developers.devision.io/metasdk/css/theme.css" rel="stylesheet">
    <link href="https://developers.devision.io/metasdk/css/dev-theme.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

    
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T3H3XF7');</script>

  </head>
  <body class="" data-url="https://developers.devision.io/metasdk/guides/rpc/">
    
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T3H3XF7"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


    


<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
            
            <span class="mdl-layout-title">
                <a href='https://developers.devision.io/metasdk/' class="header-logo-link">
                    <img src="https://metastatic.devision.io/avatar.png" width="30" />
                    META
                </a>
            </span>

            <div class="devsite-header-upper-tabs"></div>

            <div class="devsite-search-form">
                <div class="searchbox">
                        <input class="devsite-search-field" type="text" data-search-input
                               placeholder="Поиск"
                               id="search-by">

                        <div class="devsite-search-image material-icons" aria-hidden="true">search</div>
                        <script type="text/javascript" src="https://developers.devision.io/metasdk/js/lunr.min.js"></script>
                        <script type="text/javascript" src="https://developers.devision.io/metasdk/js/auto-complete.js"></script>
                        <link href="https://developers.devision.io/metasdk/css/auto-complete.css" rel="stylesheet">
                        <script type="text/javascript">
                            
                            var baseurl = "https:\/\/developers.devision.io\/metasdk";
                            
                        </script>
                        <script type="text/javascript" src="https://developers.devision.io/metasdk/js/search.js"></script>
                </div>
            </div>
        </div>
    </header>

    <main class="mdl-layout__content">
        <div class="page-content">
            <div class="mdl-grid devsite-full-site-width">

                <div class="devsite-nav mdl-cell mdl-cell--3-col mdl-cell--3-col-tablet mdl-cell--12-col-phone">
                    <nav class="devsite-section-nav">
                        <ul class="devsite-section-nav-main">
                            
                              
            
            
            
            
            
            <li data-nav-id="https://developers.devision.io/metasdk/guides/" class="devsite-nav-item devsite-nav-item-main
                        parent
                        
                        parent
                        ">
                <a href="https://developers.devision.io/metasdk/guides/" class="devsite-nav-title devsite-nav-item-main-title">
                    <span>Руководства</span>

                    
                    

                    
                    
                    

                    
                </a>
                
                <ul class="devsite-nav-expandable">
                    
                    
                    


                    
                    
                    
            
            
            
            
            
            <li data-nav-id="https://developers.devision.io/metasdk/guides/lock_service/" class="devsite-nav-item dd-item ">
                <a href="https://developers.devision.io/metasdk/guides/lock_service/" class="devsite-nav-title">
                    <span>LockService</span>
                </a>
            </li>
            
            
            
            
                    
                    
                    
                    
            
            
            
            
            
            <li data-nav-id="https://developers.devision.io/metasdk/guides/rpc/" class="devsite-nav-item dd-item active">
                <a href="https://developers.devision.io/metasdk/guides/rpc/" class="devsite-nav-title">
                    <span>Meta Services</span>
                </a>
            </li>
            
            
            
            
                    
                    
                    
                    
            
            
            
            
            
            <li data-nav-id="https://developers.devision.io/metasdk/guides/metaql/" class="devsite-nav-item dd-item ">
                <a href="https://developers.devision.io/metasdk/guides/metaql/" class="devsite-nav-title">
                    <span>METASQL</span>
                </a>
            </li>
            
            
            
            
                    
                    
                    
                    
            
            
            
            
            
            <li data-nav-id="https://developers.devision.io/metasdk/guides/exceptions/" class="devsite-nav-item dd-item ">
                <a href="https://developers.devision.io/metasdk/guides/exceptions/" class="devsite-nav-title">
                    <span>Исключения</span>
                </a>
            </li>
            
            
            
            
                    
                    
                    
                    
            
            
            
            
            
            <li data-nav-id="https://developers.devision.io/metasdk/guides/logging/" class="devsite-nav-item dd-item ">
                <a href="https://developers.devision.io/metasdk/guides/logging/" class="devsite-nav-title">
                    <span>Логирование</span>
                </a>
            </li>
            
            
            
            
                    
                    
                    
                    
            
            
            
            
            
            <li data-nav-id="https://developers.devision.io/metasdk/guides/introduction/" class="devsite-nav-item dd-item ">
                <a href="https://developers.devision.io/metasdk/guides/introduction/" class="devsite-nav-title">
                    <span>Введение</span>
                </a>
            </li>
            
            
            
            
                    
                    
                </ul>
                
            </li>
            
            
            
                            
                        </ul>
                    </nav>
            
            

    </div>
    <div class="mdl-cell mdl-cell--7-col mdl-cell--9-col-tablet mdl-cell--12-col-phone">
        <section>
        <div id="overlay"></div>
        <div class=" ">
        
          <div>
            <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                <span class="links">
                







 <a href='https://developers.devision.io/metasdk/'>META SDK</a> > <a href='https://developers.devision.io/metasdk/guides/'>Руководства</a> > Meta Services






                </span>
            </div>
          </div>
        
        
        <div id="body-inner">
          
            <h1>Meta Services</h1>
          



<h1 id="rpc-meta-services">RPC Meta Services</h1>
<p>Это API внутренних функций Меты, все эти функции доступны вам через редактор в Web-интерфейсе</p>
<h2 id="примеры">Примеры</h2>
<p><a href="https://github.com/devision-io/metasdk/tree/master/metasdk/examples/settings_api">Список примеров</a></p>
<h2 id="cacheservice">CacheService</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> metasdk <span style="color:#f92672">import</span> MetaApp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>META <span style="color:#f92672">=</span> MetaApp()
</span></span><span style="display:flex;"><span>log <span style="color:#f92672">=</span> META<span style="color:#f92672">.</span>log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>META<span style="color:#f92672">.</span>auth_user_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">11790</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Пример прогрева кеша</span>
</span></span><span style="display:flex;"><span>result <span style="color:#f92672">=</span> META<span style="color:#f92672">.</span>CacheService<span style="color:#f92672">.</span>warm_page_cache(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;88&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;4993&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;stateParams&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;firstLoading&#34;</span>: <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#34;export_res = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> str(result))
</span></span></code></pre></div><h2 id="mediaservice">MediaService</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> metasdk <span style="color:#f92672">import</span> MetaApp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>META <span style="color:#f92672">=</span> MetaApp()
</span></span><span style="display:flex;"><span>log <span style="color:#f92672">=</span> META<span style="color:#f92672">.</span>log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">.</span>chdir(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>abspath(__file__)))
</span></span><span style="display:flex;"><span>__DIR__ <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>getcwd() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>upload_file <span style="color:#f92672">=</span> open(__DIR__ <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;../assets/load_data_sample.tsv&#39;</span>, <span style="color:#e6db74">&#39;rb&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MediaService <span style="color:#f92672">=</span> META<span style="color:#f92672">.</span>MediaService
</span></span><span style="display:flex;"><span>result <span style="color:#f92672">=</span> MediaService<span style="color:#f92672">.</span>upload(upload_file, {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;isPrivate&#34;</span>: <span style="color:#66d9ef">True</span>, <span style="color:#75715e"># Файл будет доступен только для пользователя, работающего с апи</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;ttlInSec&#34;</span>: <span style="color:#ae81ff">9999</span>, <span style="color:#75715e"># Обязательно для временных файлов. Кол-во секунд через которые мета автоматически удалит файл</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;entityId&#34;</span>: <span style="color:#ae81ff">2770</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;objectId&#34;</span>: <span style="color:#e6db74">&#34;114aecf5-04f1-44fa-8ad1-842b7f31a2df&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;info&#34;</span>: {<span style="color:#e6db74">&#34;test&#34;</span>: <span style="color:#66d9ef">True</span>} <span style="color:#75715e"># Метаданные файла</span>
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#34;result = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> str(result))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># result = {&#39;id&#39;: &#39;ae2ef57a-c948-4ba4-8b68-6598352a2eb8&#39;, &#39;name&#39;: &#39;load_data_sample.tsv&#39;, &#39;extension&#39;: &#39;tsv&#39;, &#39;mime&#39;: &#39;text&#39;, &#39;url&#39;: None, &#39;creationTime&#39;: &#39;2017-11-08T16:57:46Z&#39;, &#39;userId&#39;: 4501, &#39;fileSize&#39;: 256, &#39;info&#39;: {&#39;test&#39;: True}, &#39;private&#39;: True, &#39;downloadUrlPart&#39;: &#39;/api/meta/v1/media/d/ae2ef57a-c948-4ba4-8b68-6598352a2eb8&#39;}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Скачать файл</span>
</span></span><span style="display:flex;"><span>result <span style="color:#f92672">=</span> MediaService<span style="color:#f92672">.</span>download(<span style="color:#e6db74">&#39;ae2ef57a-c948-4ba4-8b68-6598352a2eb8&#39;</span>,as_stream<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#34;result.content = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> str(result<span style="color:#f92672">.</span>content))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Информация по файлу</span>
</span></span><span style="display:flex;"><span>resp <span style="color:#f92672">=</span> MediaService<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#39;5665d822-2edb-48b8-85a5-817043900a9a&#39;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#34;resp = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> str(resp))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># resp = {&#39;id&#39;: &#39;5665d822-2edb-48b8-85a5-817043900a9a&#39;, &#39;name&#39;: &#39;load_data_sample.tsv&#39;, &#39;extension&#39;: &#39;tsv&#39;, &#39;mime&#39;: &#39;text&#39;, &#39;url&#39;: None, &#39;creationTime&#39;: &#39;2017-11-08T16:45:00Z&#39;, &#39;userId&#39;: 4501, &#39;fileSize&#39;: 256, &#39;info&#39;: {&#39;test&#39;: True}, &#39;private&#39;: True, &#39;downloadUrlPart&#39;: &#39;/api/meta/v1/media/d/5665d822-2edb-48b8-85a5-817043900a9a&#39;}</span>
</span></span></code></pre></div><p>Это выведет вам что-то вроде такого:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 16:48:19:INFO: Читаем настройки разработчика из локального файла {&#39;path&#39;: &#39;/Users/arturgspb/.rwmeta/developer_settings.json&#39;}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 16:48:19:INFO: Инициализация службы {&#39;debug&#39;: True}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Empty stdin...</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># result[&#39;rows&#39;][0][&#39;url&#39;] = http://localhost:8080/media/d/c6509ac7-b410-4f77-8f0b-7c1dfd6a871b</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># first = {u&#39;url&#39;: u&#39;http://localhost:8080/media/d/c6509ac7-b410-4f77-8f0b-7c1dfd6a871b&#39;, u&#39;id&#39;: u&#39;c6509ac7-b410-4f77-8f0b-7c1dfd6a871b&#39;, u&#39;full_path&#39;: u&#39;/mnt/static/public/74/reqtxt-2016-09-02_16-48-19-(4501).txt&#39;}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># result = {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;boxed&#34;: false,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;columns&#34;: [</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;displayName&#34;: &#34;Id&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;fullDisplayName&#34;: &#34;Id&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;isPrimary&#34;: true,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;isStyled&#34;: false,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;name&#34;: &#34;id&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;role&#34;: &#34;dimension&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;type&#34;: &#34;TEXT&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         },</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;displayName&#34;: &#34;url&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;fullDisplayName&#34;: &#34;url&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;isStyled&#34;: true,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;name&#34;: &#34;url&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;role&#34;: &#34;dimension&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;type&#34;: &#34;TEXT&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         },</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;displayName&#34;: &#34;downloadUrlPart&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;fullDisplayName&#34;: &#34;downloadUrlPart&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;isStyled&#34;: true,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;name&#34;: &#34;downloadUrlPart&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;role&#34;: &#34;dimension&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;type&#34;: &#34;TEXT&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         },</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;displayName&#34;: &#34;fullPath&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;fullDisplayName&#34;: &#34;fullPath&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;isStyled&#34;: true,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;name&#34;: &#34;fullPath&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;role&#34;: &#34;dimension&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;type&#34;: &#34;TEXT&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         }</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     ],</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;containsLego&#34;: false,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;empty&#34;: false,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;exportable&#34;: true,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;frame&#34;: false,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;hasTemplate&#34;: false,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;legoProperties&#34;: null,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;metaData&#34;: {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         &#34;filtersAvailable&#34;: true,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         &#34;orderByAvailable&#34;: false,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         &#34;pagerAvailable&#34;: false,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         &#34;searchTextAvailable&#34;: false</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     },</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;name&#34;: &#34;&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;pager&#34;: {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         &#34;limit&#34;: 20,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         &#34;maxPageLimit&#34;: 1000,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         &#34;offset&#34;: 0,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         &#34;total&#34;: null</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     },</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;rows&#34;: [</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         {</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;full_path&#34;: &#34;/mnt/static/public/74/reqtxt-2016-09-02_16-48-19-(4501).txt&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;id&#34;: &#34;c6509ac7-b410-4f77-8f0b-7c1dfd6a871b&#34;,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             &#34;url&#34;: &#34;http://localhost:8080/media/d/c6509ac7-b410-4f77-8f0b-7c1dfd6a871b&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         }</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     ],</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#34;template&#34;: null</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># }</span>
</span></span></code></pre></div><h2 id="dbqueryservice">DbQueryService</h2>
<p>Делайте запросы к БД к вашим подключениям</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Важно значть, что эти методы:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - НЕ парсят и НЕ меняют запросы к БД (кроме подстановки prepared statements)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - НЕ являются каким-то отдельным обобщенным SQL-диалектом. Т.е. запросы в этом виже будут переданы напрямую в БД</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># - Обовщяют получение данных и их типлв</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>db_adplatform <span style="color:#f92672">=</span> META<span style="color:#f92672">.</span>db(<span style="color:#e6db74">&#34;adplatform&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Методы query, all, one ОБЯЗАТЕЛЬНО должны возвращать ResultSet (может быть и пустой)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Т.е. нельзя делать UPDATE, INSET, DELETE, TRUNCATE, исключение - если в PostgreSQL вы делаете RETURNING</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Вернет стандартный метовский data_result, где есть rows, columns, meta_data и пр</span>
</span></span><span style="display:flex;"><span>data_result <span style="color:#f92672">=</span> db_adplatform<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#34;SELECT * FROM users LIMIT 10&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Вернет rows из data result</span>
</span></span><span style="display:flex;"><span>users <span style="color:#f92672">=</span> db_adplatform<span style="color:#f92672">.</span>all(<span style="color:#e6db74">&#34;SELECT * FROM users LIMIT 10&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Вернет первый элемент из rows или None, если нет первого элемента</span>
</span></span><span style="display:flex;"><span>users <span style="color:#f92672">=</span> db_adplatform<span style="color:#f92672">.</span>one(<span style="color:#e6db74">&#34;SELECT * FROM users WHERE id=4501 LIMIT 1&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Метод update используется для запросов, которые НЕ ВОЗВРАЩАЮТ результат в виде ResultSet (в БД)</span>
</span></span><span style="display:flex;"><span>db_meta_samples <span style="color:#f92672">=</span> META<span style="color:#f92672">.</span>db(<span style="color:#e6db74">&#34;meta_samples&#34;</span>)
</span></span><span style="display:flex;"><span>dr <span style="color:#f92672">=</span> db_meta_samples<span style="color:#f92672">.</span>update(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    UPDATE counters SET inc = inc + 1 WHERE name = :name
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>, {<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;md_source_update&#34;</span>})
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#34;dr = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> pretty_json(dr))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Для случаев, когда вам надо сделать массовую вставку группы строк</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Эта запись НЕ вызывает цикл вставки по одной записи, это реально групповая удобная вставка</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Является хорошей альтернативой к генерации списка VALUES или INSERT FROM SELECT с размапливанием json в таблицу</span>
</span></span><span style="display:flex;"><span>dr <span style="color:#f92672">=</span> db_meta_samples<span style="color:#f92672">.</span>batch_update(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    INSERT INTO test_batch_update VALUES (:id, :mytime::timestamp)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ON CONFLICT(id) DO UPDATE SET mod_time=NOW()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>, [
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;py_1&#34;</span>, <span style="color:#e6db74">&#34;mytime&#34;</span>: <span style="color:#e6db74">&#34;2014-01-01&#34;</span>},
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;py_2&#34;</span>, <span style="color:#e6db74">&#34;mytime&#34;</span>: <span style="color:#e6db74">&#34;2014-01-01&#34;</span>},
</span></span><span style="display:flex;"><span>])
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#34;dr = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> pretty_json(dr))
</span></span></code></pre></div><p>Отдельно стоит упомянуть про LoadData Api</p>
<p>Этот API позваоляет как в BigQuery создавать таблицу у казанной БД и потоково загружать в нее данные из файла формата TSV</p>
<p>Это позволяет ускорять вставку данных в таблицу от 2 до 4-5 раз.</p>
<p>ВАЖНО! Данные всегда добавляются в указанную таблицу и никакой очистки старых данных нет - вы должны почистить таблицу сами, если вам это нужно</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> metasdk <span style="color:#f92672">import</span> MetaApp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>META <span style="color:#f92672">=</span> MetaApp()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>os<span style="color:#f92672">.</span>chdir(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(__file__))
</span></span><span style="display:flex;"><span>__DIR__ <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>getcwd() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>upload_file <span style="color:#f92672">=</span> open(__DIR__ <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;assets/load_data_sample.tsv&#39;</span>, <span style="color:#e6db74">&#39;rb&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>configuration <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;load&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;destinationTable&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;schema&#34;</span>: <span style="color:#e6db74">&#34;public&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;table&#34;</span>: <span style="color:#e6db74">&#34;xxx_ya_stat&#34;</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;schema&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;fields&#34;</span>: [
</span></span><span style="display:flex;"><span>                {<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Date&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;DATE&#34;</span>},
</span></span><span style="display:flex;"><span>                {<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Clicks&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;LONG&#34;</span>},
</span></span><span style="display:flex;"><span>                {<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Cost&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;DECIMAL&#34;</span>},
</span></span><span style="display:flex;"><span>                {<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;AdNetworkType&#34;</span>, <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;TEXT&#34;</span>},
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>db <span style="color:#f92672">=</span> META<span style="color:#f92672">.</span>db(<span style="color:#e6db74">&#34;meta_samples&#34;</span>)
</span></span><span style="display:flex;"><span>db<span style="color:#f92672">.</span>upload_data(upload_file, configuration)
</span></span></code></pre></div><h2 id="settingsservice">SettingsService</h2>
<p>Рассчитан на чтение параметров из мета конфигурации</p>
<p>Это удобно когда вы хотите хранить ссылки/токены для вшешних api, какие-то глобальные или частные настройки.</p>
<p>При этом вы хотите дать некоторым пользователям вохможность это редактировать через интерфейс</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>settings <span style="color:#f92672">=</span> META<span style="color:#f92672">.</span>SettingsService
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Вернуть только данные</span>
</span></span><span style="display:flex;"><span>rwapp_conf <span style="color:#f92672">=</span> settings<span style="color:#f92672">.</span>data_get(<span style="color:#e6db74">&#34;rwapp&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Полная информация о данных + данные</span>
</span></span><span style="display:flex;"><span>full_rwapp_conf <span style="color:#f92672">=</span> settings<span style="color:#f92672">.</span>data_get(<span style="color:#e6db74">&#34;rwapp&#34;</span>, data_only<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>onec_url <span style="color:#f92672">=</span> settings<span style="color:#f92672">.</span>config_param(<span style="color:#e6db74">&#34;rwapp&#34;</span>, <span style="color:#e6db74">&#34;app.onec.url&#34;</span>)
</span></span></code></pre></div><h2 id="issueservice">IssueService</h2>
<p>Управляйте тикетами через стандартные методы</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> metasdk <span style="color:#f92672">import</span> MetaApp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>META <span style="color:#f92672">=</span> MetaApp()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>IssueService <span style="color:#f92672">=</span> META<span style="color:#f92672">.</span>IssueService
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>test_issue_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">12067</span>
</span></span><span style="display:flex;"><span>IssueService<span style="color:#f92672">.</span>add_issue_msg(test_issue_id, <span style="color:#e6db74">&#34;robo test&#34;</span>)
</span></span><span style="display:flex;"><span>IssueService<span style="color:#f92672">.</span>done_issue(test_issue_id)
</span></span></code></pre></div><h2 id="usermanagementservice">UserManagementService</h2>
<p>Управляйте пользователями</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> metasdk <span style="color:#f92672">import</span> MetaApp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>META <span style="color:#f92672">=</span> MetaApp()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>UserManagementService <span style="color:#f92672">=</span> META<span style="color:#f92672">.</span>UserManagementService
</span></span><span style="display:flex;"><span>resp <span style="color:#f92672">=</span> UserManagementService<span style="color:#f92672">.</span>send_recovery_notice(<span style="color:#e6db74">&#34;arturgspb&#34;</span>, <span style="color:#e6db74">&#34;meta&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#34;resp = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> str(resp))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># resp = {&#39;error&#39;: None, &#39;error_details&#39;: None, &#39;success_details&#39;: &#39;Вам отправлено уведомление о сбросе пароля на email art@realweb.ru. Следуйте инструкциям из письма.&#39;}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resp <span style="color:#f92672">=</span> UserManagementService<span style="color:#f92672">.</span>send_recovery_notice(<span style="color:#e6db74">&#34;unknown_login_123123123&#34;</span>, <span style="color:#e6db74">&#34;meta&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#34;resp = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> str(resp))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># resp = {&#39;error&#39;: &#39;user_not_found&#39;, &#39;error_details&#39;: &#39;Пользователь с таким логином не найден&#39;, &#39;success_details&#39;: None}</span>
</span></span></code></pre></div><h2 id="starterservice">StarterService</h2>
<p>Для работы с апи запускатора</p>
<h2 id="mailservice">MailService</h2>
<p>Для работы с почтовым клиентом</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> metasdk <span style="color:#f92672">import</span> MetaApp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>META <span style="color:#f92672">=</span> MetaApp()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Рекомендуется выдумывать unique_id для КАЖДОГО письма, чтобы избежать спама при ошибках или повторных запусках ваших скриптов</span>
</span></span><span style="display:flex;"><span>gen_id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HJljkasdlkjasd&#34;</span>
</span></span><span style="display:flex;"><span>META<span style="color:#f92672">.</span>MailService<span style="color:#f92672">.</span>submit_mail(<span style="color:#e6db74">&#34;meta@realweb.ru&#34;</span>, <span style="color:#e6db74">&#34;art@realweb.ru&#34;</span>, <span style="color:#e6db74">&#34;TTT&#34;</span>, <span style="color:#e6db74">&#34;ttt pong&#34;</span>, unique_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;my_mail_category__&#34;</span> <span style="color:#f92672">+</span> gen_id)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Без уникализации письма. Не рекомендуется, так как если ваш ког будет багать и бесконечно добавлять письма - то, вы можете заспамить адресатов</span>
</span></span><span style="display:flex;"><span>META<span style="color:#f92672">.</span>MailService<span style="color:#f92672">.</span>submit_mail(<span style="color:#e6db74">&#34;meta@realweb.ru&#34;</span>, <span style="color:#e6db74">&#34;art@realweb.ru&#34;</span>, <span style="color:#e6db74">&#34;TTT&#34;</span>, <span style="color:#e6db74">&#34;ttt pong&#34;</span>)
</span></span></code></pre></div>







</section>
</div>
<div class="mdl-cell mdl-cell--2-col mdl-cell--12-col-tablet mdl-cell--12-col-phone">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#примеры">Примеры</a></li>
    <li><a href="#cacheservice">CacheService</a></li>
    <li><a href="#mediaservice">MediaService</a></li>
    <li><a href="#dbqueryservice">DbQueryService</a></li>
    <li><a href="#settingsservice">SettingsService</a></li>
    <li><a href="#issueservice">IssueService</a></li>
    <li><a href="#usermanagementservice">UserManagementService</a></li>
    <li><a href="#starterservice">StarterService</a></li>
    <li><a href="#mailservice">MailService</a></li>
  </ul>
</nav>
</div>

</div>
</main>


</div>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://developers.devision.io/metasdk/js/clipboard.min.js"></script>
    <script src="https://developers.devision.io/metasdk/js/html5shiv-printshiv.min.js"></script>
    <script src="https://developers.devision.io/metasdk/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://developers.devision.io/metasdk/js/modernizr.custom.71422.js"></script>
    <script src="https://developers.devision.io/metasdk/js/learn.js"></script>
    <script src="https://developers.devision.io/metasdk/js/hugo-learn.js"></script>

  </body>
</html>

